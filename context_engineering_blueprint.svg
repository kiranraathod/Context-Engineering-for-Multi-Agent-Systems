<svg width="1600" height="1200" xmlns="http://www.w3.org/2000/svg">
  <style>
    .text-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 28px; font-weight: bold; text-anchor: middle; }
    .text-subtitle { font-family: 'Segoe UI', Arial, sans-serif; font-size: 18px; font-weight: bold; text-anchor: middle; fill: #444; }
    .text-main { font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
    .text-sub { font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; text-anchor: middle; fill: #333; }
    .text-label { font-family: 'Segoe UI', Arial, sans-serif; font-size: 10px; text-anchor: middle; font-style: italic; fill: #555; }

    .box { stroke-width: 2; rx: 10; }
    .existing-code { fill: #C8E6C9; stroke: #388E3C; } /* Light Green: The Core Engine */
    .new-infra { fill: #BBDEFB; stroke: #1976D2; } /* Light Blue: Production Infrastructure */
    .observability { fill: #FFF9C4; stroke: #FBC02D; } /* Yellow */
    .client { fill: #FFCC80; stroke: #EF6C00; } /* Orange */
    .external { fill: #D1C4E9; stroke: #512DA8; } /* Purple */
    .business-value { fill: #F8BBD0; stroke: #C2185B; } /* Pink */

    .arrow { stroke: #424242; stroke-width: 2.5; marker-end: url(#arrowhead); fill: none; }
    .dashed-arrow { stroke: #757575; stroke-width: 2; stroke-dasharray: 6,6; marker-end: url(#arrowhead-dash); fill: none;}
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#424242" /></marker>
    <marker id="arrowhead-dash" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#757575" /></marker>
  </defs>

  <text x="800" y="40" class="text-title">The Grand Blueprint: The Complete Context Engine Journey</text>

  <rect x="20" y="80" width="760" height="720" rx="15" fill="#F1F8E9" stroke="#558B2F" stroke-dasharray="8,8" />
  <text x="400" y="110" class="text-subtitle">Zone 1: The "Glass Box" Context Engine</text>

  <g id="glass-box-engine">
    <rect x="40" y="140" width="300" height="280" class="box existing-code" />
    <text x="190" y="160" class="text-main">Engine Core (engine.py)</text>
    <rect x="50" y="180" width="120" height="60" class="box existing-code" fill="#E8F5E9"/>
    <text x="110" y="200" class="text-main">Planner</text>
    <text x="110" y="215" class="text-sub">(Dynamic Plan Gen)</text>
    <rect x="210" y="180" width="120" height="60" class="box existing-code" fill="#E8F5E9"/>
    <text x="270" y="200" class="text-main">Executor</text>
    <text x="270" y="215" class="text-sub">(Manages Workflow)</text>
    <rect x="50" y="250" width="280" height="160" class="box existing-code" fill="#E8F5E9"/>
    <text x="190" y="270" class="text-main">ExecutionTrace</text>
    <text x="190" y="285" class="text-sub">(The "Flight Recorder")</text>
    <text x="190" y="310" class="text-label" font-style="normal">.log_plan()</text>
    <text x="190" y="330" class="text-label" font-style="normal">.log_step()</text>
    <text x="190" y="350" class="text-label" font-style="normal">.finalize()</text>
    <text x="190" y="380" class="text-label" font-weight="bold">Concept: Dependency Injection</text>
    <text x="190" y="395" class="text-label">All clients &amp; configs passed down</text>
    
    <rect x="420" y="140" width="340" height="120" class="box existing-code" />
    <text x="590" y="160" class="text-main">Agent Registry (registry.py)</text>
    <text x="590" y="180" class="text-sub">.get_capabilities_description()</text>
    <text x="590" y="200" class="text-sub">.get_handler()</text>
    <text x="590" y="220" class="text-label" font-weight="bold">The "Smart Toolkit"</text>
    <text x="590" y="235" class="text-label">Planner reads, Executor uses</text>

    <rect x="420" y="270" width="340" height="150" class="box existing-code" />
    <text x="590" y="290" class="text-main">Helper Functions (helpers.py)</text>
    <text x="590" y="310" class="text-sub">call_llm_robust()</text>
    <text x="590" y="330" class="text-sub">query_pinecone()</text>
    <text x="590" y="350" class="text-sub">get_embedding()</text>
    <text x="590" y="370" class="text-sub">count_tokens()</text>
    <text x="590" y="390" class="text-sub">helper_sanitize_input()</text>

    <rect x="40" y="440" width="720" height="340" class="box existing-code" />
    <text x="400" y="460" class="text-main">Specialist Agents (agents.py)</text>
    <g id="agent-summarizer">
      <rect x="60" y="480" width="200" height="120" class="box existing-code" fill="#E8F5E9"/>
      <text x="160" y="500" class="text-main">Summarizer Agent</text>
      <text x="160" y="520" class="text-sub">Capability: Context Reduction</text>
      <text x="160" y="540" class="text-label">Manages cost &amp; performance</text>
    </g>
    <g id="agent-researcher">
      <rect x="290" y="480" width="220" height="120" class="box existing-code" fill="#E8F5E9"/>
      <text x="400" y="500" class="text-main">Researcher Agent</text>
      <text x="400" y="520" class="text-sub">Capability: High-Fidelity RAG</text>
      <text x="400" y="540" class="text-label">Provides verifiable citations</text>
      <text x="400" y="560" class="text-label" font-weight="bold">Security: Uses helper_sanitize_input()</text>
    </g>
    <g id="agent-extractor">
      <rect x="540" y="480" width="200" height="120" class="box existing-code" fill="#E8F5E9"/>
      <text x="640" y="500" class="text-main">Extractor Agent</text>
      <text x="640" y="520" class="text-sub">Capability: Structured Data</text>
      <text x="640" y="540" class="text-label">Returns JSON for integration</text>
    </g>
    <g id="agent-librarian">
      <rect x="175" y="620" width="200" height="120" class="box existing-code" fill="#E8F5E9"/>
      <text x="275" y="640" class="text-main">Librarian Agent</text>
      <text x="275" y="660" class="text-sub">Capability: Procedural RAG</text>
      <text x="275" y="680" class="text-label">Retrieves Semantic Blueprints</text>
    </g>
    <g id="agent-writer">
      <rect x="425" y="620" width="200" height="120" class="box existing-code" fill="#E8F5E9"/>
      <text x="525" y="640" class="text-main">Writer Agent</text>
      <text x="525" y="660" class="text-sub">Capability: Content Generation</text>
      <text x="525" y="680" class="text-label">Combines style &amp; facts</text>
    </g>
  </g>
  
  <rect x="800" y="80" width="780" height="720" rx="15" fill="#E3F2FD" stroke="#0D47A1" stroke-dasharray="8,8" />
  <text x="1190" y="110" class="text-subtitle">Zone 2: Production Deployment Architecture</text>

  <g id="production-infra">
    <rect x="820" y="140" width="200" height="60" class="box client"/>
    <text x="920" y="160" class="text-main">Client Application</text>
    <text x="920" y="175" class="text-sub">(Web App, Mobile, etc.)</text>
    <path d="M 920, 200 v 30" class="arrow"/>
    <text x="870" y="220" class="text-label">1. Submit Goal (HTTP)</text>
    
    <rect x="820" y="240" width="200" height="80" class="box new-infra"/>
    <text x="920" y="260" class="text-main">API Gateway</text>
    <text x="920" y="275" class="text-sub">Authentication</text>
    <text x="920" y="290" class="text-sub">Rate Limiting</text>
    
    <path d="M 920, 320 v 30" class="arrow"/>

    <rect x="820" y="360" width="200" height="80" class="box new-infra"/>
    <text x="920" y="380" class="text-main">API Service</text>
    <text x="920" y="395" class="text-sub">FastAPI (Async)</text>
    <text x="920" y="410" class="text-sub">Data Validation</text>
    
    <path d="M 1020, 400 h 40" class="arrow"/>
    <text x="1085" y="380" class="text-label">2. Dispatch Task</text>
    <rect x="1090" y="360" width="200" height="80" class="box new-infra"/>
    <text x="1190" y="380" class="text-main">Task Queue</text>
    <text x="1190" y="395" class="text-sub">Celery &amp; RabbitMQ</text>
    <text x="1190" y="410" class="text-label">Decouples API from Execution</text>
    
    <path d="M 1190, 350 v -30" class="arrow"/>
    <text x="1235" y="300" class="text-label">3. Pull Task</text>

    <g id="worker-pool">
        <rect x="1090" y="140" width="480" height="150" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" />
        <text x="1330" y="160" class="text-main">Worker Pool (Autoscaling Kubernetes Deployment)</text>
        <rect x="1100" y="180" width="120" height="100" class="box existing-code" />
        <text x="1160" y="220" class="text-main">Container</text>
        <text x="1160" y="235" class="text-sub">(Docker)</text>
        <rect x="1110" y="190" width="100" height="15" fill="#A5D6A7"/>
        <text x="1160" y="202" class="text-sub" font-size="10">Python 3.11</text>
        <rect x="1110" y="250" width="100" height="15" fill="#A5D6A7"/>
        <text x="1160" y="262" class="text-sub" font-size="10">requirements.txt</text>

        <text x="1245" y="230" class="text-main" font-size="16">"Glass Box"</text>
        <text x="1245" y="250" class="text-main" font-size="16">Engine Runs Here</text>
    </g>

    <path d="M 1330, 290 v 30" class="dashed-arrow"/>
    <rect x="1380" y="330" width="180" height="110" class="box external" />
    <text x="1470" y="350" class="text-main">External Services</text>
    <text x="1470" y="370" class="text-sub">LLM API (OpenAI)</text>
    <text x="1470" y="390" class="text-sub">Vector DB (Pinecone)</text>
    <text x="1470" y="410" class="text-sub">Secrets (Vault/KMS)</text>
    
    <path d="M 1190, 440 v 30" class="arrow"/>
    <text x="1240" y="460" class="text-label">4. Persist Results</text>
    <rect x="1090" y="480" width="200" height="80" class="box new-infra" />
    <text x="1190" y="500" class="text-main">Result Store</text>
    <text x="1190" y="515" class="text-sub">(Redis / DB)</text>
    <text x="1190" y="530" class="text-label">Stores Output &amp; ExecutionTrace</text>

    <path d="M 1090, 520 h -70" class="arrow"/>
    <text x="970" y="500" class="text-label">5. Retrieve Result</text>
    <rect x="820" y="480" width="200" height="60" class="box client"/>
    <text x="920" y="500" class="text-main">Client Application</text>
    <text x="920" y="515" class="text-sub">(Polls with Trace ID)</text>
  </g>
  
  <g id="observability-stack">
    <rect x="820" y="600" width="740" height="180" class="box observability"/>
    <text x="1190" y="620" class="text-main">Observability Stack</text>
    <rect x="840" y="640" width="220" height="120" class="box observability" fill="#FFFDE7"/>
    <text x="950" y="660" class="text-main">Logging</text>
    <text x="950" y="680" class="text-sub">(ELK Stack / Splunk)</text>
    <text x="950" y="700" class="text-label">Captures structured logs</text>
    <text x="950" y="715" class="text-label">from all components</text>
    <rect x="1080" y="640" width="220" height="120" class="box observability" fill="#FFFDE7"/>
    <text x="1190" y="660" class="text-main">Metrics</text>
    <text x="1190" y="680" class="text-sub">(Prometheus &amp; Grafana)</text>
    <text x="1190" y="700" class="text-label">Monitors performance:</text>
    <text x="1190" y="715" class="text-label">CPU, latency, token use</text>
    <rect x="1320" y="640" width="220" height="120" class="box observability" fill="#FFFDE7"/>
    <text x="1430" y="660" class="text-main">Tracing</text>
    <text x="1430" y="680" class="text-sub">(Jaeger / Zipkin)</text>
    <text x="1430" y="700" class="text-label">Visualizes request path</text>
    <text x="1430" y="715" class="text-label">across distributed services</text>
    
    <path d="M 920, 440 v 160" class="dashed-arrow" />
    <path d="M 1330, 290 v 310" class="dashed-arrow" />
  </g>
  
  <rect x="20" y="820" width="1560" height="360" rx="15" fill="#FCE4EC" stroke="#880E4F" stroke-dasharray="8,8" />
  <text x="800" y="850" class="text-subtitle">Zone 3: The Business Value Proposition (The "Why")</text>
  
  <g id="business-value-pillars">
    <rect x="40" y="880" width="500" height="280" class="box business-value"/>
    <text x="290" y="900" class="text-main">The Value Multiplier Flywheel</text>
    <circle cx="290" cy="1030" r="60" fill="#F48FB1"/>
    <text x="290" y="1025" class="text-main" fill="white">Context</text>
    <text x="290" y="1045" class="text-main" fill="white">Engine</text>
    <text x="290" y="940" class="text-sub">Reduce Costs (Summarizer)</text>
    <text x="450" y="1030" class="text-sub">Increase Productivity (Extractor)</text>
    <text x="130" y="1030" class="text-sub">Accelerate Revenue (Writer)</text>
    <path d="M 290, 960 A 70 70 0 1 1 360, 1030" class="arrow"/>
    <path d="M 360, 1030 A 70 70 0 1 1 220, 1030" class="arrow"/>
    <path d="M 220, 1030 A 70 70 0 1 1 290, 960" class="arrow"/>

    <rect x="560" y="880" width="480" height="280" class="box business-value"/>
    <text x="800" y="900" class="text-main">The Pillar of Trust &amp; Compliance</text>
    <path d="M 600 1140 L 1000 1140 L 980 1090 L 620 1090 Z" fill="#F06292"/>
    <text x="800" y="1115" class="text-sub">Foundation: Secure Data Pipeline</text>
    <rect x="680" y="920" width="240" height="170" fill="#EC407A"/>
    <text x="800" y="1000" class="text-sub" fill="white">Core: Verifiable Outputs</text>
    <path d="M 640 920 L 960 920 L 980 890 L 620 890 Z" fill="#E91E63"/>
    <text x="800" y="908" class="text-main" fill="white">Outcome: Stakeholder Trust</text>
    
    <rect x="1060" y="880" width="500" height="280" class="box business-value"/>
    <text x="1310" y="900" class="text-main">The Knowledge Moat Cycle</text>
    <ellipse cx="1310" cy="1030" rx="180" ry="110" fill="#F48FB1" fill-opacity="0.5"/>
    <text x="1310" y="1120" class="text-sub">Proprietary Dataset of ExecutionTraces</text>
    <path d="M 1160 960 L 1160 920 L 1120 920 L 1200 890 L 1280 920 L 1240 920 L 1240 960 Z" fill="#F06292"/>
    <text x="1200" y="930" class="text-main" fill="white">Company IP</text>
  </g>

</svg>